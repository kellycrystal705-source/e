# Minimal Linux Kernel Config - TRIMMED FOR USB SHELL
# Target: HP 85DD, AMD Ryzen 5 3500U (Zen+, family 17h)
# Use case: Boot from USB, shell with text in/out, read/write USB storage
# Display: simpledrm/efifb only
# No networking, no NVMe, no modules, no swap, no sound
# Kernel: 6.6 LTS
# Expected size: ~1.0-1.4MB bzImage

# ===== CORE =====
CONFIG_64BIT=y
CONFIG_X86_64=y
CONFIG_SMP=y
CONFIG_NR_CPUS=8

# ===== SIZE OPTIMIZATIONS =====
CONFIG_CC_OPTIMIZE_FOR_SIZE=y
CONFIG_KERNEL_XZ=y
CONFIG_EMBEDDED=y
# CONFIG_MODULES is not set
# CONFIG_SWAP is not set

# ===== STRIP DEBUG COMPLETELY =====
# CONFIG_DEBUG_KERNEL is not set
# CONFIG_DEBUG_INFO is not set
# CONFIG_DEBUG_INFO_DWARF_TOOLCHAIN_DEFAULT is not set
# CONFIG_KALLSYMS is not set
# CONFIG_DYNAMIC_DEBUG is not set
# CONFIG_SYMBOLIC_ERRNAME is not set
# CONFIG_SLUB_DEBUG is not set
# CONFIG_DEBUG_MEMORY_INIT is not set
# CONFIG_FTRACE is not set
# CONFIG_KPROBES is not set
# CONFIG_PERF_EVENTS is not set
# CONFIG_PROFILING is not set
# CONFIG_BUG is not set
# CONFIG_ELF_CORE is not set
# CONFIG_COREDUMP is not set

# ===== CPU - AMD ONLY =====
CONFIG_MZEN=y
CONFIG_MICROCODE=y
CONFIG_MICROCODE_AMD=y
# CONFIG_MICROCODE_INTEL is not set
CONFIG_X86_LOCAL_APIC=y
CONFIG_X86_IO_APIC=y
# CONFIG_X86_MCE is not set

# ===== ACPI (required for Ryzen stability) =====
CONFIG_ACPI=y
CONFIG_ACPI_SLEEP=y
CONFIG_ACPI_PROCESSOR=y
CONFIG_ACPI_THERMAL=y
CONFIG_ACPI_BUTTON=y
CONFIG_CPU_IDLE=y
CONFIG_CPU_IDLE_GOV_MENU=y
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
CONFIG_X86_ACPI_CPUFREQ=y
CONFIG_X86_AMD_PLATFORM_DEVICE=y
# CONFIG_ACPI_AC is not set
# CONFIG_ACPI_BATTERY is not set
# CONFIG_ACPI_FAN is not set
# CONFIG_ACPI_VIDEO is not set
# CONFIG_ACPI_DOCK is not set

# ===== PCI (needed for USB controller on AMD chipset) =====
CONFIG_PCI=y
CONFIG_PCIEPORTBUS=y
CONFIG_PCI_MSI=y
CONFIG_PCI_MMCONFIG=y
CONFIG_PCI_DIRECT=y
# CONFIG_PCIEASPM is not set

# ===== EFI (HP board is UEFI) =====
CONFIG_EFI=y
CONFIG_EFI_STUB=y
CONFIG_EFIVAR_FS=y
# CONFIG_EFI_MIXED is not set
# CONFIG_EFI_CAPSULE_LOADER is not set

# ===== MEMORY =====
CONFIG_SPARSEMEM=y
CONFIG_SPARSEMEM_VMEMMAP=y
# CONFIG_TRANSPARENT_HUGEPAGE is not set
# CONFIG_NUMA is not set
# CONFIG_COMPACTION is not set
# CONFIG_MIGRATION is not set

# ===== BLOCK =====
CONFIG_BLOCK=y
# NVMe removed - not needed, booting from USB
# CONFIG_BLK_DEV_NVME is not set

# ===== USB (xHCI only - USB3, covers USB2 too) =====
CONFIG_USB_SUPPORT=y
CONFIG_USB=y
CONFIG_USB_XHCI_HCD=y
CONFIG_USB_STORAGE=y
# CONFIG_USB_UAS is not set
# CONFIG_USB_EHCI_HCD is not set
# CONFIG_USB_OHCI_HCD is not set
# CONFIG_USB_UHCI_HCD is not set
# CONFIG_USB_PRINTER is not set

# ===== DISPLAY: efifb + simpledrm only =====
CONFIG_DRM=y
CONFIG_DRM_SIMPLEDRM=y
CONFIG_FB=y
CONFIG_FB_CORE=y
CONFIG_FB_EFI=y
CONFIG_FRAMEBUFFER_CONSOLE=y
CONFIG_FRAMEBUFFER_CONSOLE_DETECT_PRIMARY=y
CONFIG_VT=y
CONFIG_VT_CONSOLE=y
CONFIG_DUMMY_CONSOLE=y
CONFIG_FONT_8x16=y
# No GPU drivers
# CONFIG_DRM_AMDGPU is not set
# CONFIG_DRM_RADEON is not set
# CONFIG_DRM_NOUVEAU is not set
# CONFIG_DRM_I915 is not set

# ===== INPUT (keyboard only) =====
CONFIG_INPUT=y
CONFIG_INPUT_KEYBOARD=y
CONFIG_KEYBOARD_ATKBD=y
CONFIG_SERIO=y
CONFIG_SERIO_I8042=y
CONFIG_SERIO_LIBPS2=y
CONFIG_HID=y
CONFIG_USB_HID=y
CONFIG_HID_GENERIC=y
# CONFIG_INPUT_MOUSE is not set
# CONFIG_INPUT_TOUCHSCREEN is not set
# CONFIG_INPUT_JOYSTICK is not set
# CONFIG_INPUT_MISC is not set

# ===== FILESYSTEMS =====
CONFIG_EXT4_FS=y
CONFIG_VFAT_FS=y
CONFIG_FAT_FS=y
CONFIG_NLS_CODEPAGE_437=y
CONFIG_NLS_ISO8859_1=y
CONFIG_NLS_UTF8=y
CONFIG_TMPFS=y
CONFIG_PROC_FS=y
CONFIG_SYSFS=y
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y
# CONFIG_BTRFS_FS is not set
# CONFIG_XFS_FS is not set
# CONFIG_FUSE_FS is not set
# CONFIG_NETWORK_FILESYSTEMS is not set
# CONFIG_QUOTA is not set
# CONFIG_AUTOFS_FS is not set
# CONFIG_INOTIFY_USER is not set
# CONFIG_FANOTIFY is not set

# ===== INITRAMFS =====
CONFIG_BLK_DEV_INITRD=y
CONFIG_INITRAMFS_SOURCE=""
CONFIG_RD_XZ=y
CONFIG_RD_GZIP=y

# ===== EXECUTABLE FORMATS =====
CONFIG_BINFMT_ELF=y
CONFIG_BINFMT_SCRIPT=y
# CONFIG_BINFMT_MISC is not set

# ===== KERNEL FEATURES =====
CONFIG_MULTIUSER=y
CONFIG_SYSCTL=y
CONFIG_FUTEX=y
CONFIG_EPOLL=y
CONFIG_SIGNALFD=y
CONFIG_TIMERFD=y
CONFIG_EVENTFD=y
CONFIG_POSIX_TIMERS=y
CONFIG_TTY=y
CONFIG_UNIX98_PTYS=y
# CONFIG_LEGACY_PTYS is not set
# CONFIG_USELIB is not set

# ===== PRINTK =====
CONFIG_PRINTK=y
CONFIG_LOG_BUF_SHIFT=12
# CONFIG_PRINTK_TIME is not set

# ===== SECURITY - stripped =====
# CONFIG_SECCOMP is not set
# CONFIG_AUDIT is not set
# CONFIG_SECURITY is not set
# CONFIG_KEYS is not set

# ===== EVERYTHING ELSE - OFF =====
# CONFIG_SOUND is not set
# CONFIG_NET is not set
# CONFIG_WIRELESS is not set
# CONFIG_BLUETOOTH is not set
# CONFIG_HIBERNATION is not set
# CONFIG_KEXEC is not set
# CONFIG_CGROUPS is not set
# CONFIG_NAMESPACES is not set
# CONFIG_CRYPTO is not set
# CONFIG_VIRTUALIZATION is not set
# CONFIG_HYPERVISOR_GUEST is not set
# CONFIG_ATA is not set
# CONFIG_SCSI is not set
# CONFIG_MD is not set
# CONFIG_DM is not set
# CONFIG_WATCHDOG is not set
# CONFIG_THERMAL is not set
# CONFIG_HWMON is not set
# CONFIG_MEDIA_SUPPORT is not set
# CONFIG_BACKLIGHT_CLASS_DEVICE is not set
# CONFIG_MMC is not set
# CONFIG_NFC is not set
# CONFIG_RFKILL is not set
# CONFIG_I2C is not set
# CONFIG_SPI is not set
# CONFIG_POWER_SUPPLY is not set
# CONFIG_PSTORE is not set
# CONFIG_RAS is not set
# CONFIG_LEDS_CLASS is not set
